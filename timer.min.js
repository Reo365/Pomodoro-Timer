document.addEventListener("DOMContentLoaded",()=>{if(!document.getElementById("minutes-tens"))return;const t=document.getElementById("minutes-tens"),e=document.getElementById("minutes-ones"),n=document.getElementById("seconds-tens"),o=document.getElementById("seconds-ones"),d=[t,e,n,o],s=document.querySelectorAll(".mode-btn"),l=document.getElementById("start-btn"),a=document.getElementById("reset-btn"),i=document.getElementById("total-focus-display"),c=document.querySelector(".mode-indicator"),r=document.querySelector(".timer-modes");let u=null,m=!0,f="pomodoro",g=0;window.totalFocusedSeconds=0;let w="",p=!1,S=0,h=0,E=0;const y={pomodoro:1500,shortBreak:300};function I(e){if(!t)return;const n=Math.floor(e/60),o=e%60,s=[Math.floor(n/10),n%10,Math.floor(o/10),o%10],l=d[0].clientHeight;d.forEach((t,e)=>{t.firstElementChild&&(t.firstElementChild.style.transform=`translateY(-${s[e]*l}px)`)})}function v(){m||(m=!0,clearInterval(u),u=null,l.classList.remove("paused"),l.title=window.TRANSLATIONS[window.htmlElement.lang].start)}function L(){l&&(v(),g=y[f],I(g))}function B(t=!0){if(!c||0===s.length||!r)return;const e=document.querySelector(`.mode-btn[data-mode="${f}"]`);if(e){const n=r.getBoundingClientRect(),o=e.getBoundingClientRect(),d=parseFloat(getComputedStyle(c).left);E=o.left-n.left-d;const l=e.offsetWidth;c.style.transition=t?"":"none",c.style.transform=`translateX(${E}px)`,c.style.width=`${l}px`,s.forEach(t=>{t.classList.toggle("active",t===e)})}}function F(t,e=!1){s.length&&(f=t,localStorage.setItem("currentMode",f),(!e||e&&t!==f)&&L(),B())}function C(t){if(!c||t.target!==c)return;p=!0,c.classList.add("dragging"),S=t.clientX;const e=window.getComputedStyle(c).transform.match(/translateX\(([^)]+)px\)/);h=e?parseFloat(e[1]):0,E=h,c.style.transition="none",document.addEventListener("pointermove",T),document.addEventListener("pointerup",R)}function T(t){if(!p)return;t.preventDefault();const e=t.clientX-S;let n=h+e;const o=r.getBoundingClientRect(),d=c.offsetWidth,s=o.width-d;E=Math.max(0,Math.min(n,s)),c.style.transform=`translateX(${E}px)`}function R(t){if(!p)return;p=!1,c.classList.remove("dragging"),c.style.transition="";let e=f,n=1/0;s.forEach(t=>{const o=t.getBoundingClientRect(),d=o.left+o.width/2,s=c.getBoundingClientRect().left+c.offsetWidth/2,l=Math.abs(d-s);l<n&&(n=l,e=t.dataset.mode)}),e!==f?F(e,!0):B(),document.removeEventListener("pointermove",T),document.removeEventListener("pointerup",R)}function A(){l&&l.addEventListener("click",()=>{m?function(){if(!l||!m)return;m=!1,l.classList.add("paused"),l.title=window.TRANSLATIONS[window.htmlElement.lang].pause;let t=g,e=Date.now();u=setInterval(()=>{const n=Math.round((Date.now()-e)/1e3);if(g=t-n,"pomodoro"===f&&(window.totalFocusedSeconds++,localStorage.setItem("totalFocusedSeconds",window.totalFocusedSeconds),window.updateTotalFocusDisplay()),g<0)return v(),alert(window.TRANSLATIONS[window.htmlElement.lang].timeUp),void F("pomodoro"===f?"shortBreak":"pomodoro");I(g)},1e3)}():v()}),a&&a.addEventListener("click",L),s.length&&s.forEach(t=>{t.addEventListener("click",t=>{const e=t.target.dataset.mode;e&&e!==f&&F(e)})}),window.addEventListener("resize",()=>{B()}),c&&c.addEventListener("pointerdown",C)}window.updateTotalFocusDisplay=function(){if(!i)return;const t=window.htmlElement.lang,e=Math.floor(window.totalFocusedSeconds/60),n=window.totalFocusedSeconds%60,o=t=>String(t).padStart(2,"0"),d=`${o(e)}${window.TRANSLATIONS[t].minutes} ${o(n)}${window.TRANSLATIONS[t].seconds}`;i.textContent=d},function(){f=localStorage.getItem("currentMode")||"pomodoro",window.totalFocusedSeconds=parseInt(localStorage.getItem("totalFocusedSeconds"))||0,w=localStorage.getItem("lastResetDate")||"";const e=(new Date).toISOString().slice(0,10);w!==e&&(window.totalFocusedSeconds=0,localStorage.setItem("totalFocusedSeconds","0"),w=e,localStorage.setItem("lastResetDate",e)),t&&d.forEach(t=>{const e=document.createElement("div");e.className="digit-reel";const n=t.id.includes("seconds-tens")||t.id.includes("minutes-tens")?6:10;for(let t=0;t<n;t++){const n=document.createElement("span");n.textContent=t,e.appendChild(n)}t.appendChild(e)}),A(),B(!1),F(f),window.updateTotalFocusDisplay()}()});