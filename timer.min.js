document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("minutes-tens"),e=document.getElementById("minutes-ones"),n=document.getElementById("seconds-tens"),o=document.getElementById("seconds-ones"),d=[t,e,n,o],s=document.querySelectorAll(".mode-btn"),a=document.getElementById("start-btn"),l=document.getElementById("reset-btn"),i=document.getElementById("total-focus-display"),c=document.querySelector(".mode-indicator"),r=document.querySelector(".timer-modes");let u=null,m=!0,w="pomodoro",g=0;window.totalFocusedSeconds=0;let f="",p=!1,S=0,h=0,E=0;const y={pomodoro:1500,shortBreak:300};function I(e){if(!t)return;const n=Math.floor(e/60),o=e%60,s=[Math.floor(n/10),n%10,Math.floor(o/10),o%10],a=d[0].clientHeight;d.forEach((t,e)=>{t.firstElementChild.style.transform=`translateY(-${s[e]*a}px)`})}function v(){m||(m=!0,clearInterval(u),u=null,a.classList.remove("paused"),a.title=window.TRANSLATIONS[window.htmlElement.lang].start)}function L(){a&&l&&(v(),g=y[w],I(g))}function F(t=!0){if(!c||0===s.length||!r)return;const e=document.querySelector(`.mode-btn[data-mode="${w}"]`);if(e){const n=r.getBoundingClientRect(),o=e.getBoundingClientRect(),d=parseFloat(getComputedStyle(c).left);E=o.left-n.left-d;const a=e.offsetWidth;c.style.transition=t?"":"none",c.style.transform=`translateX(${E}px)`,c.style.width=`${a}px`,s.forEach(t=>{t.classList.toggle("active",t===e)})}}function B(t,e=!1){s.length&&(w=t,localStorage.setItem("currentMode",w),(!e||e&&t!==w)&&L(),F())}function T(t){if(!c||t.target!==c)return;p=!0,c.classList.add("dragging"),S=t.clientX;const e=window.getComputedStyle(c).transform.match(/translateX\(([^)]+)px\)/);h=e?parseFloat(e[1]):0,E=h,c.style.transition="none",document.addEventListener("pointermove",C),document.addEventListener("pointerup",R)}function C(t){if(!p)return;t.preventDefault();const e=t.clientX-S;let n=h+e;const o=r.getBoundingClientRect(),d=c.offsetWidth,s=o.width-d;E=Math.max(0,Math.min(n,s)),c.style.transform=`translateX(${E}px)`}function R(t){if(!p)return;p=!1,c.classList.remove("dragging"),c.style.transition="";let e=w,n=1/0;s.forEach(t=>{const o=t.getBoundingClientRect(),d=o.left+o.width/2,s=c.getBoundingClientRect().left+c.offsetWidth/2,a=Math.abs(d-s);a<n&&(n=a,e=t.dataset.mode)}),e!==w?B(e,!0):F(),document.removeEventListener("pointermove",C),document.removeEventListener("pointerup",R)}function A(){a&&a.addEventListener("click",()=>{m?function(){if(!a||!l)return;if(!m)return;m=!1,a.classList.add("paused"),a.title=window.TRANSLATIONS[window.htmlElement.lang].pause;let t=g,e=Date.now();u=setInterval(()=>{const n=Math.round((Date.now()-e)/1e3);if(g=t-n,"pomodoro"===w&&(window.totalFocusedSeconds++,localStorage.setItem("totalFocusedSeconds",window.totalFocusedSeconds),window.updateTotalFocusDisplay()),g<0)return v(),alert(window.TRANSLATIONS[window.htmlElement.lang].timeUp),void B("pomodoro"===w?"shortBreak":"pomodoro");I(g)},1e3)}():v()}),l&&l.addEventListener("click",L),s.length&&s.forEach(t=>{t.addEventListener("click",t=>{const e=t.target.dataset.mode;e&&e!==w&&B(e)})}),window.addEventListener("resize",()=>{document.getElementById("minutes-tens")&&F()}),c&&c.addEventListener("pointerdown",T)}window.updateTotalFocusDisplay=function(){if(!i)return;const t=window.htmlElement.lang,e=Math.floor(window.totalFocusedSeconds/60),n=window.totalFocusedSeconds%60,o=t=>String(t).padStart(2,"0"),d=`${o(e)}${window.TRANSLATIONS[t].minutes} ${o(n)}${window.TRANSLATIONS[t].seconds}`;i.textContent=d,console.log(`updateTotalFocusDisplay called: totalFocusedSeconds=${window.totalFocusedSeconds}, displayString=${d}`)},(window.location.pathname.endsWith("index.html")||"/"===window.location.pathname)&&function(){w=localStorage.getItem("currentMode")||"pomodoro",window.totalFocusedSeconds=parseInt(localStorage.getItem("totalFocusedSeconds"))||0,f=localStorage.getItem("lastResetDate")||"";const e=(new Date).toISOString().slice(0,10);f!==e&&(window.totalFocusedSeconds=0,localStorage.setItem("totalFocusedSeconds","0"),f=e,localStorage.setItem("lastResetDate",e)),t&&d.forEach(t=>{const e=document.createElement("div");e.className="digit-reel";const n=t.id.includes("seconds-tens")||t.id.includes("minutes-tens")?6:10;for(let t=0;t<n;t++){const n=document.createElement("span");n.textContent=t,e.appendChild(n)}t.appendChild(e)}),A(),F(!1),B(w),window.updateTotalFocusDisplay()}()});